%option 8bit reentrant bison-locations
%option never-interactive
%option noyywrap noinput nounput
%option prefix="_mp_equation_"
%option extra-type="MPEquationParserState *"
%option outfile="mp-equation-lexer.c" header-file="mp-equation-lexer.h"

%{
/*  Copyright (c) 2004-2008 Sami Pietila
 *  Copyright (c) 2008-2009 Robert Ancell
 *
 *  This program is free software; you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation; either version 2, or (at your option)
 *  any later version.
 *
 *  This program is distributed in the hope that it will be useful, but
 *  WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 *  General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with this program; if not, write to the Free Software
 *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
 *  02111-1307, USA.
 */

#include <stdlib.h>
#include <locale.h>
#include <string.h>
#include <sys/types.h>

#include "mp-equation-private.h"
#include "mp-equation-parser.h"
#include "mp-equation.h"
%}


ZERO          "0"|"Ÿ†"|"€∞"|"ﬂÄ"|"‡•¶"|"‡ß¶"|"‡©¶"|"‡´¶"|"‡≠¶"|"‡Ø¶"|"‡±¶"|"‡≥¶"|"‡µ¶"|"‡πê"|"‡ªê"|"‡º†"|"·ÅÄ"|"·Çê"|"·ü†"|"·†ê"|"·•Ü"|"·ßê"|"·≠ê"|"·Æ∞"|"·±Ä"|"·±ê"|"Íò†"|"Í£ê"|"Í§Ä"|"Í©ê"|"êí†"
ONE           "1"|"Ÿ°"|"€±"|"ﬂÅ"|"‡•ß"|"‡ßß"|"‡©ß"|"‡´ß"|"‡≠ß"|"‡Øß"|"‡±ß"|"‡≥ß"|"‡µß"|"‡πë"|"‡ªë"|"‡º°"|"·ÅÅ"|"·Çë"|"·ü°"|"·†ë"|"·•á"|"·ßë"|"·≠ë"|"·Æ±"|"·±Å"|"·±ë"|"Íò°"|"Í£ë"|"Í§Å"|"Í©ë"|"êí°"
TWO           "2"|"Ÿ¢"|"€≤"|"ﬂÇ"|"‡•®"|"‡ß®"|"‡©®"|"‡´®"|"‡≠®"|"‡Ø®"|"‡±®"|"‡≥®"|"‡µ®"|"‡πí"|"‡ªí"|"‡º¢"|"·ÅÇ"|"·Çí"|"·ü¢"|"·†í"|"·•à"|"·ßí"|"·≠í"|"·Æ≤"|"·±Ç"|"·±í"|"Íò¢"|"Í£í"|"Í§Ç"|"Í©í"|"êí¢"
THREE         "3"|"Ÿ£"|"€≥"|"ﬂÉ"|"‡•©"|"‡ß©"|"‡©©"|"‡´©"|"‡≠©"|"‡Ø©"|"‡±©"|"‡≥©"|"‡µ©"|"‡πì"|"‡ªì"|"‡º£"|"·ÅÉ"|"·Çì"|"·ü£"|"·†ì"|"·•â"|"·ßì"|"·≠ì"|"·Æ≥"|"·±É"|"·±ì"|"Íò£"|"Í£ì"|"Í§É"|"Í©ì"|"êí£"
FOUR          "4"|"Ÿ§"|"€¥"|"ﬂÑ"|"‡•™"|"‡ß™"|"‡©™"|"‡´™"|"‡≠™"|"‡Ø™"|"‡±™"|"‡≥™"|"‡µ™"|"‡πî"|"‡ªî"|"‡º§"|"·ÅÑ"|"·Çî"|"·ü§"|"·†î"|"·•ä"|"·ßî"|"·≠î"|"·Æ¥"|"·±Ñ"|"·±î"|"Íò§"|"Í£î"|"Í§Ñ"|"Í©î"|"êí§"
FIVE          "5"|"Ÿ•"|"€µ"|"ﬂÖ"|"‡•´"|"‡ß´"|"‡©´"|"‡´´"|"‡≠´"|"‡Ø´"|"‡±´"|"‡≥´"|"‡µ´"|"‡πï"|"‡ªï"|"‡º•"|"·ÅÖ"|"·Çï"|"·ü•"|"·†ï"|"·•ã"|"·ßï"|"·≠ï"|"·Æµ"|"·±Ö"|"·±ï"|"Íò•"|"Í£ï"|"Í§Ö"|"Í©ï"|"êí•"
SIX           "6"|"Ÿ¶"|"€∂"|"ﬂÜ"|"‡•¨"|"‡ß¨"|"‡©¨"|"‡´¨"|"‡≠¨"|"‡Ø¨"|"‡±¨"|"‡≥¨"|"‡µ¨"|"‡πñ"|"‡ªñ"|"‡º¶"|"·ÅÜ"|"·Çñ"|"·ü¶"|"·†ñ"|"·•å"|"·ßñ"|"·≠ñ"|"·Æ∂"|"·±Ü"|"·±ñ"|"Íò¶"|"Í£ñ"|"Í§Ü"|"Í©ñ"|"êí¶"
SEVEN         "7"|"Ÿß"|"€∑"|"ﬂá"|"‡•≠"|"‡ß≠"|"‡©≠"|"‡´≠"|"‡≠≠"|"‡Ø≠"|"‡±≠"|"‡≥≠"|"‡µ≠"|"‡πó"|"‡ªó"|"‡ºß"|"·Åá"|"·Çó"|"·üß"|"·†ó"|"·•ç"|"·ßó"|"·≠ó"|"·Æ∑"|"·±á"|"·±ó"|"Íòß"|"Í£ó"|"Í§á"|"Í©ó"|"êíß"
EIGHT         "8"|"Ÿ®"|"€∏"|"ﬂà"|"‡•Æ"|"‡ßÆ"|"‡©Æ"|"‡´Æ"|"‡≠Æ"|"‡ØÆ"|"‡±Æ"|"‡≥Æ"|"‡µÆ"|"‡πò"|"‡ªò"|"‡º®"|"·Åà"|"·Çò"|"·ü®"|"·†ò"|"·•é"|"·ßò"|"·≠ò"|"·Æ∏"|"·±à"|"·±ò"|"Íò®"|"Í£ò"|"Í§à"|"Í©ò"|"êí®"
NINE          "9"|"Ÿ©"|"€π"|"ﬂâ"|"‡•Ø"|"‡ßØ"|"‡©Ø"|"‡´Ø"|"‡≠Ø"|"‡ØØ"|"‡±Ø"|"‡≥Ø"|"‡µØ"|"‡πô"|"‡ªô"|"‡º©"|"·Åâ"|"·Çô"|"·ü©"|"·†ô"|"·•è"|"·ßô"|"·≠ô"|"·Æπ"|"·±â"|"·±ô"|"Íò©"|"Í£ô"|"Í§â"|"Í©ô"|"êí©"
DECIMAL	      "."|","
DEC           {ZERO}|{ONE}|{TWO}|{THREE}|{FOUR}|{FIVE}|{SIX}|{SEVEN}|{EIGHT}|{NINE}
HEX           {DEC}|[A-F]|[a-f]
SUPER_DIGITS  "‚Å∞"|"¬π"|"¬≤"|"¬≥"|"‚Å¥"|"‚Åµ"|"‚Å∂"|"‚Å∑"|"‚Å∏"|"‚Åπ"
SUPER_MINUS   "‚Åª"
SUB_DIGITS    "‚ÇÄ"|"‚ÇÅ"|"‚ÇÇ"|"‚ÇÉ"|"‚ÇÑ"|"‚ÇÖ"|"‚ÇÜ"|"‚Çá"|"‚Çà"|"‚Çâ"
FRACTION      "¬Ω"|"‚Öì"|"‚Öî"|"¬º"|"¬æ"|"‚Öï"|"‚Öñ"|"‚Öó"|"‚Öò"|"‚Öô"|"‚Öö"|"‚Öõ"|"‚Öú"|"‚Öù"|"‚Öû"
GREEKS        "Œ±"|"Œ≤"|"Œ≥"|"Œ¥"|"Œµ"|"Œ∂"|"Œ∑"|"Œ∏"|"Œπ"|"Œ∫"|"Œª"|"Œº"|"ŒΩ"|"Œæ"|"Œø"|"œÄ"|"œÅ"|"œÇ"|"œÉ"|"œÑ"|"œÖ"|"œÜ"|"œá"|"œà"|"œâ"
DEGREES       "¬∞"
MINUTES       "'"
SECONDS       "\""
LETTERS       [a-zA-Z]|{GREEKS}

SUP_NUM  {SUPER_DIGITS}+
NSUP_NUM {SUPER_MINUS}{SUPER_DIGITS}+
SUB_NUM  {SUB_DIGITS}+
WORD     {LETTERS}+
DEC_NUM  {DEC}+|{DEC}*{DECIMAL}{DEC}+
DEF_NUM  {HEX}+|{HEX}*{DECIMAL}{HEX}+
BASE_NUM {HEX}+{SUB_NUM}|{HEX}*{DECIMAL}{HEX}+{SUB_NUM}
ANGLE_NUM {DEC_NUM}{DEGREES}|{DEC}+{DEGREES}{DEC_NUM}{MINUTES}|{DEC}+{DEGREES}{DEC}+{MINUTES}{DEC_NUM}{SECONDS}

NUMBER   {DEF_NUM}|{BASE_NUM}|{FRACTION}|{DEC}+{FRACTION}|{ANGLE_NUM}
VARIABLE {WORD}|{WORD}{SUB_NUM}|{GREEKS}

MOD  [mM][oO][dD]
AND  "‚àß"|[aA][nN][dD]
OR   "‚à®"|[oO][rR]
XOR  "‚äª"|"‚äï"|[xX][oO][rR]
LSHIFT  "<<"
RSHIFT  ">>"
NOT  "¬¨"|"~"|[nN][oO][tT]
RE   "‚É∞‚Ñú"
IM   "‚Ñë"
IN   [iI][nN]

%%

"+"         {return tADD;}
"-"|"‚àí"     {return tSUBTRACT;}
"*"|"√ó"     {return tMULTIPLY;}
"/"|"‚àï"|"√∑" {return tDIVIDE;}
{MOD}       {return tMOD;}
"‚åä"         {return tLFLOOR;}
"‚åã"         {return tRFLOOR;}
"‚åà"         {return tLCEILING;}
"‚åâ"         {return tRCEILING;}
"‚àö"         {return tROOT;}
"‚àõ"         {return tROOT3;}
"‚àú"         {return tROOT4;}
{LSHIFT}    {return tLSHIFT;}
{RSHIFT}    {return tRSHIFT;}
{NOT}       {return tNOT;}
{AND}       {return tAND;}
{OR}        {return tOR;}
{XOR}       {return tXOR;}
{IN}        {return tIN;}
{NUMBER}    {if (mp_set_from_string(yytext, _mp_equation_get_extra(yyscanner)->options->base, &yylval->int_t) != 0) REJECT; return tNUMBER;}
{SUP_NUM}   {yylval->integer = super_atoi(yytext); return tSUPNUM;}
{NSUP_NUM}  {yylval->integer = super_atoi(yytext); return tNSUPNUM;}
{SUB_NUM}   {yylval->integer = sub_atoi(yytext); return tSUBNUM;}
{VARIABLE}  {\
    MPEquationParserState *state = _mp_equation_get_extra(yyscanner);\
    if (state->function_is_defined(state, yytext)) {\
        yylval->name = strdup(yytext);\
        return tFUNCTION;\
    }\
    else {\
        yylval->name = strdup(yytext);\
        return tVARIABLE;\
    }\
}
[ \r\t\n]
.           {return *yytext;}

%%
